# 数据库索引

索引是一个单独的、存储在磁盘上的数据库结构，包含着对数据表里所有记录的引用指针。使用索引可以快速找出在某个或多个列中有一特定值的行，所有MySQL列类型都可以被索引，对相关列使用索引是提高查询操作速度的最佳途径。

索引是在存储引擎中实现的，因此，每种存储引擎的索引都不一定完全相同，并且每种存储引擎也不一定支持所有索引类型。MySQL中索引的存储类型有两种，即B+ TREE和HASH，具体和表的存储引擎相关。MyISAM和InnoDB存储引擎只支持B+ TREE索引；MEMORY/HEAP存储引擎可以支持HASH和B+ TREE索引。

# 索引种类

索引主要有普通索引、唯一索引、主键索引、单列索引、组合索引、全文索引、空间索引、复合索引几种；

- 普通索引是MySQL中的基本索引类型，允许在定义索引的列中插入重复值和空值。

- 唯一索引要求索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。

- 主键索引是一种特殊的唯一索引，不允许有空值。

- 单列索引即一个索引只包含单个列，一个表可以有多个单列索引。

- 组合（联合）索引是指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合。

- 全文索引类型为FULLTEXT，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在CHAR、VARCHAR或者TEXT类型的列上创建。

- 空间索引是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING和POLYGON。MySQL使用SPATIAL关键字进行扩展，使得能够用创建正规索引类似的语法创建空间索引。创建空间索引的列，必须将其声明为NOT NULL，空间索引只能在存储引擎为MyISAM的表中创建。

# 索引的优缺点

索引的优点就是可以大大加快数据的查询速度，在使用分组和排序子句进行数据查询时，可以显著减少查询中分组和排序的时间。

索引的缺点有三个方面：

1. 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。
2. 索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快达到最大文件尺寸。
3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。

# 索引失效的情况

1. 使用组合索引时，需要遵循“最左前缀”原则；
2. like语句的前导模糊查询不能使用索引，以通配符开头（例如%abc）的like语句，MySQL索引会失效变成全表扫描；
3. where子句中and条件相连，有一列有索引就会命中索引，加快查询速度；or条件相连，所有列都有索引才能命中索引，加快查询速度；
4. MySQL在使用负向条件查询时（!=、<>、not in、not exists、not like等）的时候无法使用索引会导致全表扫描；
5. 不在索引列上做任何操作，例如计算、函数、类型转换（字符串不加单引号会导致Mysql自己做类型转换），会导致索引失效而转向全表扫描；
6. 索引不会包含有NULL值的列，where子句中使用is null, is not null也无法使用索引；

# 索引的优化

- 避免在经常更新的表上创建过多的索引，并且索引中的列要尽可能少。应该在经常用于查询的字段上创建索引，且应避免添加不必要的字段。
- 数据量小的表最好不要使用索引，由于数据较少，全表扫描花费的时间可能比遍历索引的时间还要短，索引可能不会产生优化效果。
- 数据重复且分布比较均匀的的字段不适合建索引，例如性别、真假值，如果建立索引不但不会提高查询效率，反而会严重降低数据更新速度。
- 经常参与列计算的列上不适合建索引。
- 尽量使用覆盖索引，当select的数据列被所建索引覆盖时不需要回表，可以直接取得数据。

> 覆盖索引是select的数据列只用从索引中就能够取得，不必读取数据行，换句话说查询列要被所建的索引覆盖。覆盖索引在查询过程中不需要回表。只需要在一棵索引树上就能获取SQL所需的所有列数据，无需回表速度更快。
>
> 覆盖索引其核心就是只从辅助索引要数据。那么, 普通索引（单字段）和联合索引，以及唯一索引都能实现覆盖索引的作用。explain的输出结果Extra字段为Using index时，能够触发索引覆盖。

- 当唯一性是某种数据本身的特征时，指定唯一索引。使用唯一索引需能确保定义的列的数据完整性，以提高查询速度。
- 在频繁进行排序或分组（即进行group by或order by操作）的列上建立索引，如果待排序的列有多个，可以在这些列上建立组合索引。

# SQL优化

- 建表时，选取最适用的字段属性，尽可能减少定义字段宽度，尽量把字段设置NOTNULL；
- 在经常性的检索列上，建立必要索引，以加快搜索速率，避免全表扫描；
- 尽量使用覆盖索引，当select的数据列被所建索引覆盖时不需要回表，可以直接取得数据。
- 多次查询同样的数据，可以考虑缓存该组数据；
- SQL查询优化；
- 使用连接（JOIN）来代替子查询；
- 使用联合（UNION）来代替手动创建的临时表；